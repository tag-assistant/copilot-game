"use strict";
(() => {
  // src/webview/sprites.ts
  var PAL = {
    transparent: "rgba(0,0,0,0)",
    black: "#1a1a2e",
    darkGray: "#3d3d5c",
    gray: "#7a7a9e",
    white: "#f0f0f8",
    orange: "#ff8c42",
    orangeDark: "#d96a20",
    orangeLight: "#ffaa66",
    eye: "#2ecc71",
    eyeDark: "#1a9c54",
    pink: "#ff6b9d",
    pinkDark: "#d94a7a",
    purple: "#9b59b6",
    purpleDark: "#7b3f96",
    blue: "#3498db",
    yellow: "#f1c40f",
    red: "#e74c3c",
    green: "#2ecc71",
    tentacle: "#8e44ad",
    tentLight: "#af7ac5",
    tentDark: "#6c3483"
  };
  var C = {
    ".": PAL.transparent,
    "k": PAL.black,
    "d": PAL.darkGray,
    "g": PAL.gray,
    "w": PAL.white,
    "o": PAL.orange,
    "O": PAL.orangeDark,
    "L": PAL.orangeLight,
    "e": PAL.eye,
    "E": PAL.eyeDark,
    "p": PAL.pink,
    "P": PAL.pinkDark,
    "u": PAL.purple,
    "U": PAL.purpleDark,
    "t": PAL.tentacle,
    "T": PAL.tentLight,
    "D": PAL.tentDark,
    "b": PAL.blue,
    "y": PAL.yellow,
    "r": PAL.red,
    "G": PAL.green,
    "s": PAL.gray
  };
  var MONA_IDLE_1 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
....koooooooook.....
...kddoooooddk......
...kdddddddddk.....
...kdddddddddk.....
..ktddddddddtk.....
..ktt.kkkk.ttk......
..kt...kk...tk......
...t........t.......
....................
....................
`;
  var MONA_IDLE_2 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koookkkkkkoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
....koooooooook.....
...kddoooooddk......
...kdddddddddk.....
...kdddddddddk.....
..ktddddddddtk.....
..ktt.kkkk.ttk......
...kt..kk..tk.......
...t........t.......
....................
....................
`;
  var MONA_IDLE_3 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
....koooooooook.....
...kddoooooddk......
...kdddddddddk.....
...kdddddddddk.....
..ktddddddddtk.....
..ktt.kkkk.ttk......
..kT...kk...Tk......
..t..........t......
....................
....................
`;
  var MONA_IDLE_4 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koookkkkkkoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
....koooooooook.....
...kddoooooddk......
...kdddddddddk.....
...kdddddddddk.....
..ktddddddddtk.....
..kTt.kkkk.tTk......
...kt..kk..tk.......
....t......t........
....................
....................
`;
  var MONA_WALK_1 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
....koooooooook.....
...kddoooooddk......
...kdddddddddk.....
..kkdddddddddkk....
..kt.kkddddkttk....
..ktt..kk..kttk....
...t....kk..t.......
....................
....................
....................
`;
  var MONA_WALK_2 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
....koooooooook.....
...kddoooooddk......
...kdddddddddk.....
...kdddddddddk.....
..ktkdddddddkTk....
..ktt.kk.kk.ttk....
...t..kk..kk.t.....
....................
....................
....................
`;
  var MONA_WALK_3 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
....koooooooook.....
...kddoooooddk......
...kdddddddddk.....
...kkddddddddkk....
..kttkkddddkttk....
..ktt.kk..k.Ttk....
...t..kk.....t......
....................
....................
....................
`;
  var MONA_WALK_4 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
....koooooooook.....
...kddoooooddk......
...kdddddddddk.....
...kdddddddddk.....
..kTkdddddddktk....
..ktt.kk.kk.ttk....
...t..kk..kk.t.....
....................
....................
....................
`;
  var MONA_CODE_1 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
..bbkoooooooook.....
.bbbkddoooooddk.....
..b.kdddddddddk....
...kdddddddddk.....
..ktddddddddtk.....
..ktt.kkkk.ttk......
..kt...kk...tk......
...t........t.......
....................
....................
`;
  var MONA_CODE_2 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
....koooooooookbb...
...kddoooooddkbbb..
...kdddddddddk.b...
...kdddddddddk.....
..ktddddddddtk.....
..ktt.kkkk.ttk......
..kt...kk...tk......
...t........t.......
....................
....................
`;
  var MONA_CODE_3 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
.bbbkoooooooook.....
.bb.kddoooooddk.....
..b.kdddddddddk....
...kdddddddddk.....
..ktddddddddtk.....
..ktt.kkkk.ttk......
..kt...kk...tk......
...t........t.......
....................
....................
`;
  var MONA_CODE_4 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
....kooooooookbbb...
...kddoooooddk.bb...
...kdddddddddk.b...
...kdddddddddk.....
..ktddddddddtk.....
..ktt.kkkk.ttk......
..kt...kk...tk......
...t........t.......
....................
....................
`;
  var MONA_SPELL_1 = `
........uu..........
.....kkuuukk........
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
..Tkkoooooooooktt...
.TTTkddoooooddkTTT.
..T.kdddddddddk.T..
...kdddddddddk.....
..ktddddddddtk.....
..ktt.kkkk.ttk......
..kt...kk...tk......
...t........t.......
....................
....................
`;
  var MONA_SPELL_2 = `
.......uuuu.........
....u.kkuukk........
....koOk..koOk.u....
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
.tTkkoooooooookTt...
TTTTkddoooooddkTTTT
.TT.kddddddddkTT...
...kdddddddddk.....
..ktddddddddtk.....
..ktt.kkkk.ttk......
..kt...kk...tk......
...t........t.......
....................
....................
`;
  var MONA_SPELL_3 = `
......uuuuuu........
...uu.kkuukk.u......
....koOk..koOk......
...koooOkkOoook.u...
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
..TkkoooooooookT....
.TTTkddoooooddkTTT.
..T.kdddddddddk.T..
...kdddddddddk.....
..kTddddddddTk.....
..kTt.kkkk.tTk......
..kT...kk...Tk......
...T........T.......
....................
....................
`;
  var MONA_SPELL_4 = `
.......uuuu.........
.....kkuuukk........
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
.ttkkoooooooooktt...
.TTTkddoooooddkTTT.
..T.kdddddddddk.T..
...kdddddddddk.....
..ktddddddddtk.....
..kTt.kkkk.tTk......
..kt...kk...tk......
...t........t.......
....................
....................
`;
  var MONA_FIGHT_1 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooopPoooook......
...koooooooooook....
...kkoooooooookk....
....koooooooook.t...
...kddoooooddk.tTk..
...kdddddddddk.tT..
...kdddddddddk.....
..ktddddddddtk.....
..ktt.kkkk.ttk......
..kt...kk...tk......
...t........t.......
....................
....................
`;
  var MONA_FIGHT_2 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooopPoooook......
...koooooooooook....
...kkoooooooookk.tT.
....koooooooook.tTk.
...kddoooooddk..tT..
...kdddddddddk.....
...kdddddddddk.....
..ktddddddddtk.....
..ktt.kkkk.ttk......
..kt...kk...tk......
...t........t.......
....................
....................
`;
  var MONA_FIGHT_3 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook.tTT
..kooopPoooook..tTk.
...koooooooooook.t..
...kkoooooooookk....
....koooooooook.....
...kddoooooddk......
...kdddddddddk.....
...kdddddddddk.....
..ktddddddddtk.....
..ktt.kkkk.ttk......
..kt...kk...tk......
...t........t.......
....................
....................
`;
  var MONA_FIGHT_4 = `
....................
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooeekkeeoook....
..koookk..kkoook....
..kooopPoooook......
...koooooooooook....
...kkoooooooookk....
....koooooooook..t..
...kddoooooddk..tTk.
...kdddddddddk.tT..
...kdddddddddk.....
..ktddddddddtk.....
..ktt.kkkk.ttk......
..kt...kk...tk......
...t........t.......
....................
....................
`;
  var MONA_CELEBRATE_1 = `
.........yy.........
.....kk.yykk........
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooweeweoook.....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
....koooooooook.....
...kddoooooddk......
...kdddddddddk.....
...kdddddddddk.....
..kTddddddddTk.....
..kTt.kkkk.tTk......
..kT...kk...Tk......
...T........T.......
....................
....................
`;
  var MONA_CELEBRATE_2 = `
..yy..........yy....
.....kk....kk.......
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooweeweoook.....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
....koooooooook.....
...kddoooooddk......
..kkdddddddddkk....
..kt.kdddddk.tk....
..ktt..kk..kttk....
...t...kk...t.......
...T........T.......
....................
....................
....................
`;
  var MONA_CELEBRATE_3 = `
....yy....yy........
.....kk.yykk........
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooweeweoook.....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
....koooooooook.....
...kddoooooddk......
...kdddddddddk.....
...kdddddddddk.....
..kTddddddddTk.....
..kTt.kkkk.tTk......
...T...kk...T.......
....................
....................
....................
`;
  var MONA_CELEBRATE_4 = `
....................
..yy.kk....kk.yy...
....koOk..koOk......
...koooOkkOoook.....
...koooooooooook....
..koooweeweoook.....
..koookk..kkoook....
..kooooopoooook.....
...koooooooooook....
...kkoooooooookk....
....koooooooook.....
...kddoooooddk......
...kdddddddddk.....
..kkdddddddddkk....
..kt.kkddkkk.tk....
..kTt.kk..k.Ttk....
...T..kk....T.......
....................
....................
....................
`;
  var MONA_DAMAGE_1 = `
....................
......kk....kk......
.....koOk..koOk.....
....koooOkkOoook....
....koooooooooook...
...koookkkkkkoook...
...koookk..kkoook...
...kooooooooook.....
....koooooooooook...
....kkoooooooookk...
.....koooooooook....
....kddoooooddk.....
....kdddddddddk....
...kkdddddddddkk...
...kt.kdddddk.tk...
...ktt..kk...ttk....
....t........t......
....................
....................
....................
`;
  var MONA_DAMAGE_2 = `
....................
....kk....kk........
...koOk..koOk.......
..koooOkkOoook......
..koooooooooook.....
.koookkkkkkoook.....
.koookk..kkoook.....
.kooooooooook.......
..koooooooooook.....
..kkoooooooookk.....
...koooooooook......
..kddoooooddk.......
..kdddddddddk......
..kdddddddddk......
.ktddddddddtk......
.ktt.kkkk.ttk.......
.kt...kk...tk.......
..t........t........
....................
....................
`;
  var MONA_SLEEP_1 = `
....................
....................
....................
....................
....................
....................
..............b.....
.............b......
....................
.....kk..kk.........
....koookOoook......
...kookkkkkoook.....
..kooooooooooook....
..koooooooooook.....
..kdddddddddddk....
..ktttttttttttk.....
...kkkkkkkkkkkk.....
....................
....................
....................
`;
  var MONA_SLEEP_2 = `
....................
....................
....................
....................
....................
..............b.....
.............b......
............b.......
....................
.....kk..kk.........
....koookOoook......
...kookkkkkoook.....
..kooooooooooook....
..koooooooooook.....
..kdddddddddddk....
..ktttttttttttk.....
...kkkkkkkkkkkk.....
....................
....................
....................
`;
  var MONA_SLEEP_3 = `
....................
....................
....................
....................
..............b.....
.............b......
............b.......
....................
....................
.....kk..kk.........
....koookOoook......
...kookkkkkoook.....
..kooooooooooook....
..koooooooooook.....
..kdddddddddddk....
..ktttttttttttk.....
...kkkkkkkkkkkk.....
....................
....................
....................
`;
  var MONA_SLEEP_4 = `
....................
....................
....................
..............b.....
.............b......
............b.......
....................
....................
....................
.....kk..kk.........
....koookOoook......
...kookkkkkoook.....
..kooooooooooook....
..koooooooooook.....
..kdddddddddddk....
..ktttttttttttk.....
...kkkkkkkkkkkk.....
....................
....................
....................
`;
  var ENEMY_BUG = `
....................
....................
......rr..rr........
.....krrkkrrk.......
....krrrrrrrk.......
....krwrkwrrk.......
....krrrrrrrk.......
....krrrrrrrkk......
.....krrrrrrk.......
.....kkrrrkk........
......k.k.k........
.....k..k..k........
....................
....................
....................
....................
....................
....................
....................
....................
`;
  var WARNING_BUG = `
....................
....................
....................
.......yy...........
......kyykk.........
.....kyyyryk........
.....kykkyyk........
.....kyyyyyyk.......
......kyyyryk.......
......kkykk.........
.......k.k..........
....................
....................
....................
....................
....................
....................
....................
....................
....................
`;
  var DESK_COMPUTER = `
....................
....................
....kkkkkkkkkk......
....kbbbbbbbbk......
....kbbbbbbbbk......
....kbbbbbbbbk......
....kbbbbbbbbk......
....kkkkkkkkkk......
......k....k........
...kkkkkkkkkkkk.....
...kdddddddddk.....
...kdddddddddk.....
...kdddddddddk.....
...kk........kk.....
....................
....................
....................
....................
....................
....................
`;
  var BOOKSHELF = `
....................
...kkkkkkkkkkk......
...kOoObbrOoOk......
...kOoObbrOoOk......
...kkkkkkkkkkk......
...krroObbOoOk......
...krroObbOoOk......
...kkkkkkkkkkk......
...kOoOrrOobbk......
...kOoOrrOobbk......
...kkkkkkkkkkk......
...kk........kk.....
....................
....................
....................
....................
....................
....................
....................
....................
`;
  var FILING_CABINET = `
....................
....................
....kkkkkkkkk.......
....kdddddddk......
....kdd.dd.ddk......
....kkkkkkkkk.......
....kdddddddk......
....kdd.dd.ddk......
....kkkkkkkkk.......
....kdddddddk......
....kdd.dd.ddk......
....kkkkkkkkk.......
....kk.....kk.......
....................
....................
....................
....................
....................
....................
....................
`;
  var EASEL = `
....................
....................
.......kkk..........
......kppbk.........
......kpbbk.........
......kbppk.........
......kkkkk.........
.......k.k..........
......k...k.........
.....k.....k........
....k.......k.......
....................
....................
....................
....................
....................
....................
....................
....................
....................
`;
  var COFFEE_CUP = `
....................
....................
....................
....................
....................
....................
....................
....................
....................
....................
....................
....................
....................
........g...........
.......kOOk.........
.......kOOkk........
.......kOOkk........
........kkk.........
....................
....................
`;
  var DOOR = `
....................
....................
..kkkkkkkkkk........
..kOOOOOOOOk........
..kOOOOOOOOk........
..kOOOOOOOOk........
..kOOOOOOOOk........
..kOOOOOyOOk........
..kOOOOOOOOk........
..kOOOOOOOOk........
..kOOOOOOOOk........
..kOOOOOOOOk........
..kOOOOOOOOk........
..kkkkkkkkkk........
....................
....................
....................
....................
....................
....................
`;
  function parseSprite(data) {
    return data.trim().split("\n").map(
      (row) => row.split("").map((ch) => C[ch] || C["."])
    );
  }
  function renderSpriteToCanvas(pixels, size) {
    const canvas2 = document.createElement("canvas");
    canvas2.width = size;
    canvas2.height = size;
    const ctx2 = canvas2.getContext("2d");
    const pixelW = size / pixels[0].length;
    const pixelH = size / pixels.length;
    for (let y = 0; y < pixels.length; y++) {
      for (let x = 0; x < pixels[y].length; x++) {
        if (pixels[y][x] !== C["."]) {
          ctx2.fillStyle = pixels[y][x];
          ctx2.fillRect(Math.floor(x * pixelW), Math.floor(y * pixelH), Math.ceil(pixelW), Math.ceil(pixelH));
        }
      }
    }
    return canvas2;
  }
  var cachedSprites = null;
  var cachedEnemySprites = null;
  var cachedFurniture = null;
  var cachedSize = 0;
  function getMonaSprites(size = 64) {
    if (cachedSprites && cachedSize === size)
      return cachedSprites;
    cachedSize = size;
    const r = (s) => renderSpriteToCanvas(parseSprite(s), size);
    cachedSprites = {
      idle: { frames: [r(MONA_IDLE_1), r(MONA_IDLE_2), r(MONA_IDLE_3), r(MONA_IDLE_4)], frameRate: 2, loop: true },
      walk: { frames: [r(MONA_WALK_1), r(MONA_WALK_2), r(MONA_WALK_3), r(MONA_WALK_4)], frameRate: 8, loop: true },
      code: { frames: [r(MONA_CODE_1), r(MONA_CODE_2), r(MONA_CODE_3), r(MONA_CODE_4)], frameRate: 6, loop: true },
      spell: { frames: [r(MONA_SPELL_1), r(MONA_SPELL_2), r(MONA_SPELL_3), r(MONA_SPELL_4)], frameRate: 4, loop: true },
      fight: { frames: [r(MONA_FIGHT_1), r(MONA_FIGHT_2), r(MONA_FIGHT_3), r(MONA_FIGHT_4)], frameRate: 8, loop: true },
      celebrate: { frames: [r(MONA_CELEBRATE_1), r(MONA_CELEBRATE_2), r(MONA_CELEBRATE_3), r(MONA_CELEBRATE_4)], frameRate: 4, loop: true },
      damage: { frames: [r(MONA_DAMAGE_1), r(MONA_DAMAGE_2)], frameRate: 6, loop: false },
      sleep: { frames: [r(MONA_SLEEP_1), r(MONA_SLEEP_2), r(MONA_SLEEP_3), r(MONA_SLEEP_4)], frameRate: 1, loop: true }
    };
    return cachedSprites;
  }
  function getEnemySprites(size = 48) {
    if (cachedEnemySprites)
      return cachedEnemySprites;
    cachedEnemySprites = {
      bug: renderSpriteToCanvas(parseSprite(ENEMY_BUG), size),
      warning: renderSpriteToCanvas(parseSprite(WARNING_BUG), Math.floor(size * 0.7))
    };
    return cachedEnemySprites;
  }
  function getFurnitureSprites(size = 64) {
    if (cachedFurniture)
      return cachedFurniture;
    const r = (s) => renderSpriteToCanvas(parseSprite(s), size);
    cachedFurniture = {
      desk: r(DESK_COMPUTER),
      bookshelf: r(BOOKSHELF),
      cabinet: r(FILING_CABINET),
      easel: r(EASEL),
      coffee: r(COFFEE_CUP),
      door: r(DOOR)
    };
    return cachedFurniture;
  }
  function getFurnitureType(filename) {
    const ext = filename.split(".").pop()?.toLowerCase() || "";
    if (["ts", "js", "tsx", "jsx", "py", "go", "rs", "java", "c", "cpp"].includes(ext))
      return "code";
    if (["json", "yaml", "yml", "toml", "xml", "csv"].includes(ext))
      return "data";
    if (["md", "txt", "rst", "adoc"].includes(ext))
      return "docs";
    if (["css", "html", "scss", "less", "svg"].includes(ext))
      return "design";
    return "default";
  }

  // src/webview/sound.ts
  var audioCtx = null;
  var soundEnabled = false;
  function setSoundEnabled(enabled) {
    soundEnabled = enabled;
    if (enabled && !audioCtx) {
      audioCtx = new AudioContext();
    }
  }
  function playTone(freq, duration, type = "square", volume = 0.08) {
    if (!soundEnabled || !audioCtx)
      return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.value = freq;
    gain.gain.setValueAtTime(volume, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(1e-3, audioCtx.currentTime + duration);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + duration);
  }
  function sfxType() {
    playTone(800 + Math.random() * 200, 0.05, "square", 0.03);
  }
  function sfxSave() {
    playTone(523, 0.1, "sine", 0.06);
    setTimeout(() => playTone(659, 0.1, "sine", 0.06), 100);
    setTimeout(() => playTone(784, 0.15, "sine", 0.06), 200);
  }
  function sfxError() {
    playTone(200, 0.15, "sawtooth", 0.06);
    setTimeout(() => playTone(150, 0.2, "sawtooth", 0.06), 150);
  }
  function sfxBugDefeated() {
    playTone(400, 0.08, "square", 0.05);
    setTimeout(() => playTone(600, 0.08, "square", 0.05), 80);
  }
  function sfxLevelUp() {
    const notes = [523, 659, 784, 1047];
    notes.forEach((n, i) => {
      setTimeout(() => playTone(n, 0.15, "sine", 0.07), i * 120);
    });
  }
  function sfxCopilot() {
    playTone(880, 0.1, "sine", 0.05);
    setTimeout(() => playTone(1100, 0.12, "sine", 0.05), 100);
  }

  // src/webview/game.ts
  var canvas = document.getElementById("game");
  var ctx = canvas.getContext("2d");
  var statusEl = document.getElementById("status");
  var fileEl = document.getElementById("file");
  var streakEl = document.getElementById("streak");
  var xpBarEl = document.getElementById("xp-bar-fill");
  var xpBarContainer = document.getElementById("xp-bar");
  var levelEl = document.getElementById("level");
  var stateIconEl = document.getElementById("state-icon");
  var statsTooltipEl = document.getElementById("stats-tooltip");
  var W = 400;
  var H = 300;
  var monaSize = 64;
  function resize() {
    W = canvas.parentElement.clientWidth;
    H = canvas.parentElement.clientHeight - 56;
    canvas.width = W;
    canvas.height = H;
  }
  resize();
  window.addEventListener("resize", resize);
  var sprites;
  var enemySprites;
  var furniture;
  function initSprites(size) {
    monaSize = size;
    sprites = getMonaSprites(size);
    enemySprites = getEnemySprites(Math.floor(size * 0.75));
    furniture = getFurnitureSprites(size);
  }
  initSprites(64);
  var state = {
    monaX: 0,
    monaY: 0,
    targetX: 0,
    targetY: 0,
    state: "idle",
    stateTimer: 0,
    prevState: "idle",
    currentFile: "Welcome!",
    roomHue: 220,
    furnitureType: "default",
    animFrame: 0,
    animTimer: 0,
    facingRight: true,
    particles: [],
    enemies: [],
    streak: 0,
    streakTimer: 0,
    statusText: "\u{1F431} Mona is ready!",
    statusTimer: 0,
    idleTimer: 0,
    deepIdleTimer: 0,
    shakeTimer: 0,
    stats: { linesCoded: 0, filesVisited: 0, bugsDefeated: 0, savesMade: 0, copilotAssists: 0, totalXP: 0, level: 1 },
    levelUpTimer: 0,
    levelUpText: "",
    errorBadge: 0,
    attackCooldown: 0,
    config: { soundEnabled: false, monaSize: 64, showXPBar: true },
    dustTimer: 0
  };
  state.monaX = W / 2 - monaSize / 2;
  state.monaY = H - monaSize - 20;
  state.targetX = state.monaX;
  state.targetY = state.monaY;
  function xpForLevel(level) {
    return level * 100 + (level - 1) * 50;
  }
  function addXP(amount) {
    state.stats.totalXP += amount;
    const needed = xpForLevel(state.stats.level);
    let xpInLevel = state.stats.totalXP;
    let lvl = 1;
    let req = xpForLevel(1);
    while (xpInLevel >= req) {
      xpInLevel -= req;
      lvl++;
      req = xpForLevel(lvl);
    }
    if (lvl > state.stats.level) {
      state.stats.level = lvl;
      state.levelUpTimer = 2.5;
      state.levelUpText = `Level ${lvl}!`;
      spawnLevelUpParticles();
      sfxLevelUp();
    }
    state.stats.level = lvl;
    updateXPBar(xpInLevel, req);
    updateStatsTooltip();
    postToExtension({ type: "saveStats", stats: state.stats });
  }
  function updateXPBar(current, needed) {
    if (!xpBarEl)
      return;
    const pct = Math.min(100, current / needed * 100);
    xpBarEl.style.width = `${pct}%`;
    if (levelEl)
      levelEl.textContent = `Lv.${state.stats.level}`;
  }
  function updateStatsTooltip() {
    if (!statsTooltipEl)
      return;
    const s = state.stats;
    statsTooltipEl.textContent = `Lines: ${s.linesCoded} | Files: ${s.filesVisited} | Bugs: ${s.bugsDefeated} | Saves: ${s.savesMade} | Copilot: ${s.copilotAssists}`;
  }
  function postToExtension(msg) {
    try {
      window.acquireVsCodeApi?.()?.postMessage?.(msg);
    } catch {
    }
  }
  var vscodeApi = (() => {
    try {
      return window.acquireVsCodeApi();
    } catch {
      return null;
    }
  })();
  function hashStr(s) {
    let h = 0;
    for (let i = 0; i < s.length; i++)
      h = (h << 5) - h + s.charCodeAt(i) | 0;
    return Math.abs(h);
  }
  function drawRoom() {
    const h = state.roomHue;
    ctx.fillStyle = `hsl(${h}, 30%, 15%)`;
    ctx.fillRect(0, 0, W, H);
    const tileSize = 32;
    for (let y = 0; y < H; y += tileSize) {
      for (let x = 0; x < W; x += tileSize) {
        const alt = ((x / tileSize | 0) + (y / tileSize | 0)) % 2;
        ctx.fillStyle = alt ? `hsl(${h}, 25%, 13%)` : `hsl(${h}, 30%, 16%)`;
        ctx.fillRect(x, y, tileSize, tileSize);
      }
    }
    ctx.fillStyle = `hsl(${h}, 35%, 20%)`;
    ctx.fillRect(0, 0, W, 60);
    ctx.fillStyle = `hsl(${h}, 40%, 25%)`;
    ctx.fillRect(0, 55, W, 8);
    if (furniture) {
      ctx.drawImage(furniture.door, 10, H - monaSize - 30, monaSize * 0.8, monaSize);
    }
    drawFurniture();
    ctx.fillStyle = `hsl(${h}, 50%, 60%)`;
    ctx.font = "10px monospace";
    ctx.textAlign = "center";
    const shortName = state.currentFile.split("/").pop() || state.currentFile;
    ctx.fillText(`\u{1F4C1} ${shortName}`, W / 2, 35);
    ctx.textAlign = "left";
  }
  function drawFurniture() {
    if (!furniture)
      return;
    const ft = state.furnitureType;
    const fSize = monaSize * 0.8;
    const rightX = W - fSize - 20;
    const bottomY = H - fSize - 10;
    switch (ft) {
      case "code":
        ctx.drawImage(furniture.desk, rightX, 65, fSize, fSize);
        ctx.drawImage(furniture.coffee, rightX - fSize * 0.4, bottomY, fSize * 0.5, fSize * 0.5);
        break;
      case "data":
        ctx.drawImage(furniture.cabinet, rightX, 65, fSize, fSize);
        break;
      case "docs":
        ctx.drawImage(furniture.bookshelf, rightX, 65, fSize, fSize);
        break;
      case "design":
        ctx.drawImage(furniture.easel, rightX, 65, fSize, fSize);
        break;
      default:
        ctx.drawImage(furniture.desk, rightX, 65, fSize, fSize);
        break;
    }
  }
  function setState(newState, duration = 0) {
    if (state.state === newState && duration === 0)
      return;
    state.prevState = state.state;
    state.state = newState;
    state.stateTimer = duration;
    state.animFrame = 0;
    state.animTimer = 0;
    updateStateIcon();
  }
  function updateStateIcon() {
    if (!stateIconEl)
      return;
    const icons = {
      idle: "\u{1F60A}",
      walk: "\u{1F6B6}",
      code: "\u2328\uFE0F",
      spell: "\u{1F52E}",
      fight: "\u2694\uFE0F",
      celebrate: "\u{1F389}",
      damage: "\u{1F4A5}",
      sleep: "\u{1F634}"
    };
    stateIconEl.textContent = icons[state.state] || "\u{1F431}";
  }
  function setStatus(text) {
    state.statusText = text;
    state.statusTimer = 3;
  }
  function spawnParticles(x, y, color, count, type = "normal") {
    for (let i = 0; i < count; i++) {
      state.particles.push({
        x,
        y,
        vx: (Math.random() - 0.5) * (type === "confetti" ? 6 : 4),
        vy: type === "confetti" ? -Math.random() * 4 - 2 : -Math.random() * 3 - 1,
        life: 1,
        maxLife: type === "confetti" ? 1.5 : 0.5 + Math.random() * 0.5,
        color,
        size: type === "confetti" ? 3 + Math.random() * 4 : 2 + Math.random() * 3,
        type: type || "normal"
      });
    }
  }
  function spawnDustMotes() {
    if (state.particles.length > 100)
      return;
    state.particles.push({
      x: Math.random() * W,
      y: Math.random() * H,
      vx: (Math.random() - 0.5) * 0.3,
      vy: -0.1 - Math.random() * 0.2,
      life: 1,
      maxLife: 3 + Math.random() * 3,
      color: `hsl(${state.roomHue}, 20%, 50%)`,
      size: 1 + Math.random() * 1.5,
      type: "dust"
    });
  }
  function spawnCodingParticles() {
    const x = state.monaX + monaSize / 2 + (Math.random() - 0.5) * 20;
    const y = state.monaY + monaSize * 0.6;
    spawnParticles(x, y, "#3498db", 2);
  }
  function spawnSaveWave() {
    const cx = state.monaX + monaSize / 2;
    const cy = state.monaY + monaSize / 2;
    for (let i = 0; i < 16; i++) {
      const angle = i / 16 * Math.PI * 2;
      state.particles.push({
        x: cx,
        y: cy,
        vx: Math.cos(angle) * 3,
        vy: Math.sin(angle) * 3,
        life: 1,
        maxLife: 0.8,
        color: "#f1c40f",
        size: 3,
        type: "ring",
        angle
      });
    }
  }
  function spawnTerminalCircle() {
    const cx = state.monaX + monaSize / 2;
    const cy = state.monaY + monaSize;
    for (let i = 0; i < 12; i++) {
      const angle = i / 12 * Math.PI * 2;
      state.particles.push({
        x: cx + Math.cos(angle) * 20,
        y: cy + Math.sin(angle) * 8,
        vx: 0,
        vy: -0.5,
        life: 1,
        maxLife: 1.5,
        color: "#9b59b6",
        size: 2 + Math.random() * 2,
        type: "ring",
        angle
      });
    }
  }
  function spawnLevelUpParticles() {
    const cx = state.monaX + monaSize / 2;
    const cy = state.monaY + monaSize / 2;
    for (let i = 0; i < 24; i++) {
      const angle = i / 24 * Math.PI * 2;
      state.particles.push({
        x: cx,
        y: cy,
        vx: Math.cos(angle) * 4,
        vy: Math.sin(angle) * 4,
        life: 1,
        maxLife: 1.2,
        color: i % 2 === 0 ? "#f1c40f" : "#f39c12",
        size: 3 + Math.random() * 3,
        type: "ring"
      });
    }
  }
  function spawnConfetti() {
    const colors = ["#e74c3c", "#3498db", "#2ecc71", "#f1c40f", "#9b59b6", "#e67e22"];
    for (let i = 0; i < 30; i++) {
      state.particles.push({
        x: Math.random() * W,
        y: -10,
        vx: (Math.random() - 0.5) * 3,
        vy: Math.random() * 2 + 1,
        life: 1,
        maxLife: 2 + Math.random(),
        color: colors[Math.floor(Math.random() * colors.length)],
        size: 3 + Math.random() * 4,
        type: "confetti"
      });
    }
  }
  function spawnCopilotSparkles() {
    const cx = state.monaX + monaSize / 2;
    const cy = state.monaY;
    const colors = ["#58a6ff", "#79c0ff", "#a5d6ff"];
    for (let i = 0; i < 8; i++) {
      state.particles.push({
        x: cx + (Math.random() - 0.5) * 40,
        y: cy + Math.random() * monaSize,
        vx: (Math.random() - 0.5) * 2,
        vy: -Math.random() * 3 - 1,
        life: 1,
        maxLife: 1,
        color: colors[Math.floor(Math.random() * colors.length)],
        size: 2 + Math.random() * 3,
        type: "normal"
      });
    }
  }
  function spawnEnemy(isWarning = false) {
    const side = Math.random() > 0.5 ? W + 20 : -20;
    state.enemies.push({
      x: side,
      y: H - monaSize - 20 - Math.random() * 40,
      hp: isWarning ? 1.5 : 3,
      maxHp: isWarning ? 1.5 : 3,
      bobOffset: Math.random() * Math.PI * 2,
      dying: false,
      dyingTimer: 0,
      isWarning,
      speed: isWarning ? 20 : 30,
      flashTimer: 0,
      knockbackVx: 0
    });
  }
  function handleEvent(ev) {
    state.idleTimer = 0;
    state.deepIdleTimer = 0;
    switch (ev.type) {
      case "init":
        setStatus("\u{1F431} Mona is ready to code!");
        if (ev.config)
          applyConfig(ev.config);
        break;
      case "configUpdate":
        if (ev.config)
          applyConfig(ev.config);
        break;
      case "fileOpen":
        state.currentFile = ev.file || "unknown";
        state.roomHue = hashStr(state.currentFile) % 360;
        state.furnitureType = getFurnitureType(state.currentFile);
        state.targetX = W / 2 - monaSize / 2 + (Math.random() - 0.5) * 80;
        setState("walk");
        state.stats.filesVisited++;
        addXP(5);
        setStatus(`\u{1F4C2} Entering ${state.currentFile.split("/").pop()}`);
        break;
      case "fileChange":
        state.streak++;
        state.streakTimer = 3;
        state.stats.linesCoded++;
        addXP(1);
        setState("code", 2);
        spawnCodingParticles();
        sfxType();
        setStatus(`\u2328\uFE0F Coding... (${state.streak}x streak!)`);
        break;
      case "fileSave":
        state.stats.savesMade++;
        addXP(10);
        spawnSaveWave();
        sfxSave();
        setStatus("\u{1F4BE} Checkpoint saved!");
        break;
      case "terminal":
        setState("spell", 2);
        spawnTerminalCircle();
        setStatus("\u{1F52E} Casting terminal spell...");
        break;
      case "errorsAppear": {
        const count = ev.errorCount || 1;
        state.errorBadge += count;
        for (let i = 0; i < Math.min(count, 3); i++)
          spawnEnemy(false);
        setState("fight", 4);
        state.shakeTimer = 0.4;
        sfxError();
        spawnParticles(W / 2, H / 2, "#e74c3c", 6);
        setStatus(`\u2694\uFE0F ${count} bug${count > 1 ? "s" : ""} appeared!`);
        break;
      }
      case "warningsAppear": {
        const count = ev.warningCount || 1;
        for (let i = 0; i < Math.min(count, 2); i++)
          spawnEnemy(true);
        setState("fight", 3);
        setStatus(`\u26A0\uFE0F ${count} warning${count > 1 ? "s" : ""} appeared!`);
        break;
      }
      case "errorsCleared":
        state.enemies.forEach((e) => {
          e.dying = true;
          e.dyingTimer = 0.5;
          spawnParticles(e.x, e.y, "#e74c3c", 5);
          sfxBugDefeated();
        });
        state.errorBadge = 0;
        setState("celebrate", 2);
        spawnConfetti();
        addXP(25);
        setStatus("\u{1F389} All bugs defeated!");
        break;
      case "copilotAssist":
        state.stats.copilotAssists++;
        addXP(15);
        spawnCopilotSparkles();
        sfxCopilot();
        setStatus("\u2728 Copilot assisted!");
        break;
      case "idle":
        if (state.state !== "fight") {
          setState("idle");
          setStatus("\u{1F60A} Mona is waiting...");
        }
        break;
    }
  }
  function applyConfig(config) {
    if (config.soundEnabled !== void 0) {
      state.config.soundEnabled = config.soundEnabled;
      setSoundEnabled(config.soundEnabled);
    }
    if (config.monaSize && config.monaSize !== monaSize) {
      state.config.monaSize = config.monaSize;
      initSprites(config.monaSize);
    }
    if (config.showXPBar !== void 0) {
      state.config.showXPBar = config.showXPBar;
      if (xpBarContainer)
        xpBarContainer.style.display = config.showXPBar ? "block" : "none";
    }
  }
  function getAnim() {
    return sprites[state.state] || sprites.idle;
  }
  var lastTime = 0;
  function update(dt) {
    if (state.stateTimer > 0) {
      state.stateTimer -= dt;
      if (state.stateTimer <= 0 && state.state !== "sleep") {
        setState("idle");
      }
    }
    state.idleTimer += dt;
    if (state.state === "idle") {
      state.deepIdleTimer += dt;
      if (state.deepIdleTimer > 30) {
        setState("sleep");
        setStatus("\u{1F634} Mona is napping... ZZZ");
      }
    }
    if (state.state === "walk") {
      const dx = state.targetX - state.monaX;
      const speed = 120;
      if (Math.abs(dx) > 2) {
        state.monaX += Math.sign(dx) * speed * dt;
        state.facingRight = dx > 0;
      } else {
        state.monaX = state.targetX;
        setState("idle");
      }
    }
    state.monaX = Math.max(10, Math.min(W - monaSize - 10, state.monaX));
    state.monaY = H - monaSize - 20;
    const anim = getAnim();
    state.animTimer += dt;
    const frameDur = 1 / anim.frameRate;
    if (state.animTimer >= frameDur) {
      state.animTimer -= frameDur;
      state.animFrame++;
      if (state.animFrame >= anim.frames.length) {
        state.animFrame = anim.loop ? 0 : anim.frames.length - 1;
      }
    }
    if (state.state === "fight") {
      state.attackCooldown -= dt;
      if (state.attackCooldown <= 0) {
        state.attackCooldown = 0.5;
        let nearest = null;
        let nearestDist = Infinity;
        for (const e of state.enemies) {
          if (e.dying)
            continue;
          const dx = Math.abs(state.monaX + monaSize / 2 - e.x);
          if (dx < nearestDist) {
            nearestDist = dx;
            nearest = e;
          }
        }
        if (nearest && nearestDist < monaSize * 1.5) {
          nearest.hp -= 1;
          nearest.flashTimer = 0.1;
          nearest.knockbackVx = Math.sign(nearest.x - state.monaX - monaSize / 2) * 40;
          if (nearest.hp <= 0) {
            nearest.dying = true;
            nearest.dyingTimer = 0.4;
            state.stats.bugsDefeated++;
            state.errorBadge = Math.max(0, state.errorBadge - 1);
            addXP(10);
            spawnParticles(nearest.x, nearest.y, nearest.isWarning ? "#f1c40f" : "#e74c3c", 8);
            sfxBugDefeated();
          }
        }
      }
    }
    for (let i = state.enemies.length - 1; i >= 0; i--) {
      const enemy = state.enemies[i];
      if (enemy.dying) {
        enemy.dyingTimer -= dt;
        if (enemy.dyingTimer <= 0) {
          state.enemies.splice(i, 1);
        }
        continue;
      }
      const dx = state.monaX + monaSize / 2 - enemy.x;
      if (Math.abs(dx) > 40) {
        enemy.x += Math.sign(dx) * enemy.speed * dt;
      }
      if (enemy.knockbackVx !== 0) {
        enemy.x += enemy.knockbackVx * dt;
        enemy.knockbackVx *= 0.9;
        if (Math.abs(enemy.knockbackVx) < 1)
          enemy.knockbackVx = 0;
      }
      enemy.bobOffset += dt * 3;
      if (enemy.flashTimer > 0)
        enemy.flashTimer -= dt;
    }
    if (state.state === "fight" && state.enemies.filter((e) => !e.dying).length === 0) {
      setState("idle");
      if (state.enemies.length === 0) {
        setStatus("\u{1F60A} All clear!");
      }
    }
    state.dustTimer += dt;
    if (state.dustTimer > 2) {
      state.dustTimer = 0;
      spawnDustMotes();
    }
    for (let i = state.particles.length - 1; i >= 0; i--) {
      const p = state.particles[i];
      p.x += p.vx;
      p.y += p.vy;
      if (p.type === "confetti") {
        p.vy += 2 * dt;
        p.vx *= 0.99;
      } else if (p.type !== "dust") {
        p.vy += 3 * dt;
      }
      p.life -= dt / p.maxLife;
      if (p.life <= 0)
        state.particles.splice(i, 1);
    }
    if (state.streakTimer > 0) {
      state.streakTimer -= dt;
    } else if (state.streak > 0 && state.idleTimer > 3) {
      state.streak = Math.max(0, state.streak - 1);
    }
    if (state.shakeTimer > 0)
      state.shakeTimer -= dt;
    if (state.levelUpTimer > 0)
      state.levelUpTimer -= dt;
    if (state.statusTimer > 0)
      state.statusTimer -= dt;
  }
  function draw() {
    ctx.save();
    if (state.shakeTimer > 0) {
      const intensity = state.shakeTimer * 15;
      ctx.translate(
        (Math.random() - 0.5) * intensity,
        (Math.random() - 0.5) * intensity
      );
    }
    drawRoom();
    for (const enemy of state.enemies) {
      const bob = Math.sin(enemy.bobOffset) * 4;
      ctx.save();
      if (enemy.dying) {
        const scale = enemy.dyingTimer / 0.4;
        ctx.globalAlpha = scale;
        const cx = enemy.x + (enemy.isWarning ? 16 : 24);
        const cy = enemy.y + (enemy.isWarning ? 16 : 24) + bob;
        ctx.translate(cx, cy);
        ctx.scale(scale, scale);
        ctx.translate(-cx, -cy);
      }
      if (enemy.flashTimer > 0) {
        ctx.globalAlpha = 0.5 + Math.sin(enemy.flashTimer * 60) * 0.5;
      }
      const sprite = enemy.isWarning ? enemySprites.warning : enemySprites.bug;
      ctx.drawImage(sprite, enemy.x, enemy.y + bob);
      if (!enemy.dying) {
        const barW = enemy.isWarning ? 24 : 32;
        ctx.fillStyle = "#333";
        ctx.fillRect(enemy.x + 4, enemy.y - 8, barW, 4);
        ctx.fillStyle = enemy.isWarning ? "#f1c40f" : "#e74c3c";
        ctx.fillRect(enemy.x + 4, enemy.y - 8, barW * (enemy.hp / enemy.maxHp), 4);
      }
      ctx.restore();
    }
    const anim = getAnim();
    const frame = anim.frames[state.animFrame] || anim.frames[0];
    ctx.save();
    if (!state.facingRight) {
      ctx.translate(state.monaX + monaSize, state.monaY);
      ctx.scale(-1, 1);
      ctx.drawImage(frame, 0, 0);
    } else {
      ctx.drawImage(frame, state.monaX, state.monaY);
    }
    ctx.restore();
    for (const p of state.particles) {
      ctx.globalAlpha = Math.max(0, p.life);
      ctx.fillStyle = p.color;
      if (p.type === "confetti") {
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate((p.angle || 0) + p.life * 5);
        ctx.fillRect(-p.size / 2, -p.size / 4, p.size, p.size / 2);
        ctx.restore();
      } else {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size / 2, 0, Math.PI * 2);
        ctx.fill();
      }
    }
    ctx.globalAlpha = 1;
    if (state.errorBadge > 0) {
      ctx.fillStyle = "#e74c3c";
      ctx.beginPath();
      ctx.arc(W - 25, 75, 12, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = "#fff";
      ctx.font = "bold 10px monospace";
      ctx.textAlign = "center";
      ctx.fillText(`${state.errorBadge}`, W - 25, 79);
      ctx.textAlign = "left";
    }
    if (state.levelUpTimer > 0) {
      ctx.save();
      ctx.globalAlpha = Math.min(1, state.levelUpTimer);
      ctx.fillStyle = "#f1c40f";
      ctx.font = "bold 24px monospace";
      ctx.textAlign = "center";
      const yOff = (2.5 - state.levelUpTimer) * 20;
      ctx.fillText(state.levelUpText, W / 2, H / 2 - yOff);
      ctx.textAlign = "left";
      ctx.restore();
    }
    ctx.restore();
    fileEl.textContent = `\u{1F4C1} ${(state.currentFile || "No file").split("/").pop()}`;
    statusEl.textContent = state.statusText;
    streakEl.textContent = state.streak > 0 ? `\u{1F525} ${state.streak}x` : "";
  }
  function gameLoop(time) {
    const dt = Math.min((time - lastTime) / 1e3, 0.1);
    lastTime = time;
    update(dt);
    draw();
    requestAnimationFrame(gameLoop);
  }
  window.addEventListener("message", (e) => {
    const data = e.data;
    if (data.type === "loadStats") {
      Object.assign(state.stats, data.stats);
      let xpInLevel = state.stats.totalXP;
      let lvl = 1;
      let req = xpForLevel(1);
      while (xpInLevel >= req) {
        xpInLevel -= req;
        lvl++;
        req = xpForLevel(lvl);
      }
      state.stats.level = lvl;
      updateXPBar(xpInLevel, req);
      updateStatsTooltip();
    } else {
      handleEvent(data);
    }
  });
  lastTime = performance.now();
  requestAnimationFrame(gameLoop);
  handleEvent({ type: "init" });
})();
